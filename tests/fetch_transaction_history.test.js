import FetchTransactionHistory from '../src/fetch_transaction_history'
import getOpReturn from '../src/get_opreturn'
import nock from 'nock'
import { map, compact } from 'lodash'

test('load transaction history by a given address', () => {

    nock('https://api.blockcypher.com:443', {"encodedQueryParams":true})
        .get('/v1/btc/test3/addrs/mjw2BcBvNKkgLvQyYhzRERRgWSUVG7HHTb/full')
        .reply(200, ["1f8b0800000000000003ed5b6b531b4716fdbebf82d2e745d5ef07dfd6896d2a36aef593c45b29aa9fa018240c029ba4f2dff7f48ca66704020b4776d9bba19c18cfb446d3b76fdf73eeb9b7fff8c7d6d6c8c57896cecf473b5ba393df3eb007e1c1e5b327ef0e9f5e3ebffae5e8f7170f5fbc38dc7ff9facd63bdbbfbca8ffe593e329fcdddf1c1590a697299223ec929134a084107b7cfd3748e5bd40c6f7977eca62195eb9cb43fcd472ea66136cd93b393140ffa31a4b99727537c5b7f75f993d383f9473c4edf78cce2c6f0194b63e71fcb9cff83f96c6dfdd1fc1f33f3c7b3f0eee0c89d1fe1de68f186ed5f5ce5ec298b929114b93692f06c08cd89446f92a03a7996acb73e651654505ed0c65ae5f9dd73d3e4f0a8310a934ad3e69d07b727d398ca5c982a93696e746fa20d4b2c2bc39cb2d438ad6914524aada45746069ef06a24736e59964c074b9de554c72cb9b2199febdf64b1dca99f7cf345ec995693ddfd27f9c5d3df7e7af6eac99ba30767cf670fa278107653084fe8dea3fa0ccc873d7b903dfbf1e59be47f70f149b8f44f3f3c09d31fdefff02a9def9eb0dda337c3e16b38d662c6bfd6a9374e066b50cb08319a302e79bd99533301da2c4dbd7a3ef9bd712dd12c7a33afd3b394d3596a7d6e7404fbd7f71a9da56377551ceeaa2c363572cccc58ab31d576871ace793fb47a6719c908d5db946d33fb8aca1d41f0e76d3f74b02dae8de47c479831617630fa329d9539d629c4d9853f4e07e7a7695a365676c7e7a9debc9c4c0fce7f5f1a7f39bb98b7d7581db67859379fcca6659999e2c22edf8d0b8bf45f3c999e5ecc979da2db159d212febc650d1504d9c4a5c3bc63c613965ea8c37d45bee8c4b4126fc17101494e3ca6388545c62d3d02082edddb17934a680ef3ee8dcbfbe5373f33c9c4d4ecb9e1951450815d153696d20f07822b3b44a6b4399323e3913988d581c4c57b591aa3ca1fc8c165f71e98e2f1a0f697cca2cf95433ee3cbdbf589846302bf074666567ba66c4eafdd3dc5a670f2ddcbc8cafaede7cb89de7c1fceab4bce0e8d45d6dcf67dbedd5ed260c2cbfc661338f1247485df9e6411f26f3691bcfdbd8562e969f11274210c688b2898b90826326ea10580c2a07ab7580358d0ecc73a31daef9e08ce188df3219c4b89468083a715b9e4139063363ad510eabea7da6562b4f6d4630cc2412ea3dd30881044113868c7878f62e38ca9c6609f7eb8659bc1d615a67ec414658d44e45c7a373d266e185e7c906eada854d34333c9a2a95adcb1c11d06626b4087434b46dfdfdcf1b81a5f5853b5cbd7ac910a2dad784197b87d4ca592a3851d17b18ca6ba3ad8ef05262790e541ba2bc64c213cef0fac6b8b034e90e79af85e266add60f9865f83a9e747ae1dfa5abd6937ae3f43eb5b4d9ab05003698d58a7d527765314170248644120f34eb207364dc8b2c7d925878668199366127218a2f1ba044b9f922fc224a18ee38914400dc34671c084715933c2a2761e2187514311307c865d4060f4f8353c664b48f412c3ff9ce5dfa69e8aa065acfb6c35d5a3f5a1dafb9f2676be9ceca1d21b84e3410aab58d54679fbd00841b6ebcc24603babbe899e104961526818c78dafc1b3bd7e73af9eeb93dd1605aea1e0e5b7ed3455ad5036a251a6014342ac3a5b2c67bf0081f22f665d680dcec950cd230f01da302915a3b0b2a1423e2bca42982a1f46fb27a094627872f7ed97dacf29bd7af4fcf76e5ece78f93777bfb17879393939fa2dcdbdfff501f81cdb6c63ee85d787432a32ccd2ee2a3a727ef7f7bffcbd5137371f8e0f1dec3c97c4f9be793cb67d32e46d41dd372d902a906c6b68456f4192d38065cb222c068c13018eb2f2d338ce359fffed70906576326f898cb315d8760d06d0282a17698d8a16240196e128c6e24a53b8c8c29a183d15f83604809a4ecd661d4d08fbf4830b4a289d9a4b3cb2a659e23f1322bab000e227886e01f8551462565112044c6e5e8117999ccc6d001736ba2e99a0443e81e227db28e2a6724e72165299941b0d126729988615478cba88bd65902c28dada92c51d82252248d7b052205113eda12cea2a294e1334470af2d539268962d989302b38eda2061504a0134b8970ae0c6923702a905a3840909ec03c0192d4d0e204f8a33869dc9180b0114089bcf8ba478109109c4084355c600a1b58812383bd84c2b68107c5e8010d4b56bacf59738d01a1bb646c8f582eb10b83a1f6bded32d281021888af5a135ec766317dc6f2dbcbf16025a7354a86bf19e806f80881a05c683950e816b19650031a21134289908369a7dba1fde7f3a2ad619dedf6cf5a30b142af3ea90a8996387f77291f176b65b6900c9c0099d305652f831520b2e057c284be5b28349005e1c545cdc34c010ef41ad5d82ff31e4d148556d32c9326c314aa427c9c38d09828a244984283d86c998b0c7b8e19e58cbd8b263af069be6f5d7078532bc02c360ead749f9d0237bd32e7efbb5f97b3db8a7a0c7b66cda221a80ea30cc1af89f85751e26908824c279c41f22237406ae41239da177c17db319bae55bb0810eee91cbd43b3dde6f28d0dec266ef8be0e7e2d5e99ed42ff677a70fdfcb7fbf7834cf3f195090c9cfb3d70ff93c5fde8de0481ffa68d6213865d8a275e61d840b532fad0de18c32a803748ca51a5325ab0fb69857d4ab92bb35fa00b1db8cbd226a87ea1dce06807c03be1723a124a81d4ec794c9c1e8cdc177cff5a29bbb83d3b3d97c1666c7e5852fa6efa6b30fd31bd3a90a82617ac0153701f05e235f124a8b248343b810128c37126720a43167216019a40c929674334b50001a6c70ca13e49645e1aaefdaecd375011efc594880337423a8750e1964c45b04700a046de914735e3b9e1c782f658170410c60173bd2529210d5917b08851c84315e205e4374b0c05b01da08bdc810f0f42c6434098ff652420ca48923d9b65cc387910851e444512311c7fc80de5f07e2ab325b6c557e46df19c45303ea646e86daba81d74fe90bc0751f6b4d710dde75b290ae183c4171ae82405eef82e69e532cbbb10e393d789803cdbc4f3abf76582beff4f918d4cf6c25bc971c6705dfbb6681cf173486f85ea4e98d2492cd2add85ef9f2e5a54cff982b6bdcdab94231ea98a4445009a1a43d2acb266f8fd0ec5627a717cdc2f65d59c2a0f29f7b74b145f8e824d5c3f6a4a08a375beb2197f3e3f9b4c0f0b0aeca6e3e3d9d6feecec387620bbb555e9f43d688da3284810a46931316d81bec438ae49a18450f5201745669052891c03e2269336403316ea0e5ad30680ce24d7680daffae7a863351b43976f82d5d8a5005e594dc3d5ab4d2aade9ab4acbb4e6ceda873663cec612ca0408cba74a1fc434a50fd43dd80e3303b27293da74234be9438f01a883d1df06b5418ead584f0537c16d6c94d0c95d498918712e39a4fe0c7951b4c8dfa16b468d429e05c66401fe00c90f323bd71035bdc32691bd86d684be75b94d152f446220555a72237340893240cbc0b6234e223195c209515e01759ba25440de808ea0918d41592510d6390c526a0444534c214103940eaa0a15d2e9949c0a09da0bb4107809e60254143c45838a0b72144164514b22d2e2afc16cf09a5dcdb958aafc7c97cc46577caad1b66eebfb319bdb40a8552efed7a9cd0a6ff842d466433973e3b17f531bd477bf176a23ac485ca2a80959366608bf480f698e0a355054b9c06d1c44d980288a2c53a2b8aaf0bb573a55a276a340d3509b1eb3970b347dcede319b8d61cbb7c06ca0770d03f82798cdad3597bb988dd26370ee3110187511790f6ec3c06df480addcce6d20f010701bfd65649b9edc5e6feb68984bafe86d82b98017a096cf13f8800c04755ce814503ab2a468ebf0dea17300a420428761a8053a941d1445a1c383016814807b41ac896cf7662e323bc951bc30517254804b5d4350d0158a7abf412d0655112728a8095a48a00f33191d41db15d5a04f041599c25c24fa025093f43250101214af0345b15453145120b12a8f5aa54f5090932fbb9842ca870cedd1d8805e16c2d0e9f055980b5b72fcef94b970b1394de6ff99b9ace4b15f84b96c2c2ffe5698cb8239dfa7e882d626c831197d2d1e4d0c1a7d9809012c40b58da82f9730404940d2c6a003a3ab2927a44e28edf5ad2bab201c5ba152f66508ef037407e11b0bb2df0484f3a548f625209cf2b10682533b86ecbe1e829ba631d3ec2c7542ac44f07624dd217c0c0a37c0fbcda91377223880ad3ace26101c593b45b504bd9084463465a10e0d25565a599a8155425716d5cea1b331a35a4d144aaa94790dbe4ab342b165b92daf6b9bec0a88b537a605ac1aa2fac60974ea25a805287ca0e18f6987668d1cd09601c113d50f34262840bc36e8bc24264198c8a0c76820356842a45c0674922218e69892400948ea1c1cd40ce818048aa2877e98c14028fa9c337a288440634846a7a988a028a024960783ced4af83e07dbf7b3146f9f9eeb487a2fad8bfb58761bfedead27eb7436fe99a8086bd8acfd5edf157fb448765958de57f8dc77e03dac36720389a7e5199a3ca5a148323c3791014729119086f8ce50a7aab47cfaa0288670c44a38ea694c6d4d78c6f2278b315ba65be565f684fb534f6ea207c6351f656089ff0e77b4ff767af1fbf7cf498bf9fbda6fa59fed73bf1f66a7ef9f6a37bf6b6472a049e359aaebab961f494e6d97cfa68f7a7cb976fcef74e7efc282edc63f9ecb97ab91b9eeefdfc612f75e59f5a88ac5d92c2402d2fdd686810ed1e5931bf1ccca917bb7ac4ad59fb52a7e422b71df64fa074400b8c23bdbefb7c452947ac1c791dc29bb33df3c949d3398f9623a836f575bfc4b90b8ace26d34b3b9b807774083a0d558953914d41441524ea6b962634fba167106d8a0ecdc1e8ddc5f6f091021d018ac05085a341389d5475a8c69daf25e875f19a9b7d9ffb00de258e3de14f69e60685402b92cb288e138efa26a8044e788079e448711c830a86be61a806686fd2a8dee3db516000bc03f143c0cb46086460238ad060d0e8992c4e1fa0b0c048d08484a44bd7bfc2535d022787d729d4de8d08b285f758ea0f6895c6c912e7a1239942277022c5a2df194c5e7394e879e6ca95732a0806d0e68837100720cfc17cfdd19ea121ba36b885978382f45ededa64c5f110d1f95033e2ae88fae93d5dc1f8fe85eae5b7685b231b1fdf08c2c322383c827300dc2ecfb7f79216e562c431b44c124e6520872219ddff1062d0968d1502fb63e81f17be9cd5b9d13e31443910441ceec1a93a23b1ac0a3dae3982bf96e6591cac436d1935ab8003740ada2bfa0411e8d179d834e5a2ec05ed75d9cdef5893f5636159dd1a0f5b676800be2ad78b133b9fcb2056f1c92fc22036967e7ed2dfbf5263c63283c0bf7efdc79fff05cf6625c8da3a0000"],
               [ 'Server',
                 'nginx/1.13.6',
                 'Date',
                 'Fri, 16 Feb 2018 17:28:06 GMT',
                 'Content-Type',
                 'application/json',
                 'Transfer-Encoding',
                 'chunked',
                 'Connection',
                 'close',
                 'Access-Control-Allow-Headers',
                 'Origin, X-Requested-With, Content-Type, Accept',
                 'Access-Control-Allow-Methods',
                 'GET, POST, PUT, DELETE',
                 'Access-Control-Allow-Origin',
                 '*',
                 'X-Ratelimit-Remaining',
                 '99',
                 'Content-Encoding',
                 'gzip' ]);
    
    // nock.recorder.rec();
    let getter = new FetchTransactionHistory()
    return getter.getFromBlockchain('mjw2BcBvNKkgLvQyYhzRERRgWSUVG7HHTb').then((txs) => {
        expect(txs.length).toBe(7)
        let withOpReturn = compact(
            map(txs, (tx) => {
                return getOpReturn(tx)
            }))
        expect(withOpReturn.length).toBe(2)
    })
})
